import{d as T,f as E,a as v,_ as B}from"./dateTime-aec4e621.js";import{u as $,A as g,a as O}from"./useDataProvider-11001eb3.js";import{d as C,c as l,o as n,a as i,u as s,t as c,b as y,h as p,a5 as F,g as U,l as w,F as S,f as A}from"./index-b9aa134f.js";import{u as D,a as I}from"./CompetitionView-10baf9f9.js";const V={key:0,class:"tabular-nums"},L={key:1},M={key:2},z={class:"text-ellipsis overflow-hidden whitespace-nowrap"},H={key:3},P={key:4},Y={key:5,class:"text-right tabular-nums"},j={key:6,class:"text-right"},q={key:7,class:"text-right tabular-nums"},G={key:8},x=C({__name:"CategoryTableFinishedRow",props:{data:null,isEven:{type:Boolean},isCompact:{type:Boolean}},setup(t){const e=t,{now:a}=$(),d=5*60,m=l(()=>e.data.updatedAt?T(a.value,e.data.updatedAt)<d:!1),f=l(()=>m.value?"bg-highlight":e.isEven?"bg-even":"bg-white"),r=l(()=>m.value?"text-white":"text-black"),h=l(()=>e.isCompact?"table-row-grid-compact":"table-row-grid");return(o,u)=>(n(),i("div",{class:F([[s(f),s(r),s(h)],"grid gap-2 px-3 py-1.5 rounded-lg"])},[t.data.status===s(g).Ok?(n(),i("span",V,c(t.data.rank)+".",1)):t.data.status===s(g).NotCompeting?(n(),i("span",L,"NC")):(n(),i("span",M)),y("span",z,c(t.data.surname)+" "+c(t.data.firstName),1),t.isCompact?p("",!0):(n(),i("span",H,c(t.data.card),1)),t.isCompact?p("",!0):(n(),i("span",P,c(t.data.club),1)),t.data.status===s(g).Ok||t.data.status===s(g).NotCompeting?(n(),i("span",Y,c(t.data.time),1)):(n(),i("span",j,c(s(E)(t.data.status)),1)),t.data.loss?(n(),i("span",q,"+ "+c(t.data.loss),1)):(n(),i("span",G))],2))}});const J=y("span",null,null,-1),K={class:"text-ellipsis overflow-hidden whitespace-nowrap"},Q={key:0},W={key:1},X={key:2,class:"text-right tabular-nums"},Z={key:3,class:"text-right tabular-nums"},tt={key:4},et=y("span",null,null,-1),st=C({__name:"CategoryTableUnfinishedRow",props:{data:null,isEven:{type:Boolean},isVisible:{type:Boolean},isCompact:{type:Boolean}},setup(t){const e=t,a=e.isEven?"bg-even":"bg-white",{now:d,timeFormatter:m}=$(),f=l(()=>e.data.startTime?e.data.startTime<d.value:e.data.status===g.Running),r=l(()=>m.format(e.data.startTime)),h=l(()=>{if(!e.data.startTime||!f.value||!e.isVisible)return"";const u=T(d.value,e.data.startTime);return v(u)}),o=l(()=>e.isCompact?"table-row-grid-compact":"table-row-grid");return(u,R)=>(n(),i("div",{class:F([[s(a),s(o)],"grid table-row-grid gap-2 px-3 py-1.5 rounded-lg"])},[J,y("span",K,c(t.data.surname)+" "+c(t.data.firstName),1),t.isCompact?p("",!0):(n(),i("span",Q,c(t.data.card),1)),t.isCompact?p("",!0):(n(),i("span",W,c(t.data.club),1)),s(f)?(n(),i("span",X,"( "+c(s(h))+" )",1)):s(f)?(n(),i("span",tt)):(n(),i("span",Z,c(s(r)),1)),et],2))}});function nt({competition:t,category:e,fetchEnabled:a}){const{getAthletesLoader:d}=O(),{rawAthletes:m,status:f}=d({category:e,competition:t,fetchEnabled:a}),r=l(()=>f.value!=="success"||!m.value?{finished:[],unfinished:[]}:m.value.reduce((o,u)=>(u.status===g.NotStarted||u.status===g.Running?o.unfinished.push(u):o.finished.push(u),o),{finished:[],unfinished:[]})),h=l(()=>r.value.finished.length>0||r.value.unfinished.length>0);return{status:f,athletes:r,areAvailable:h}}function at(t){return l(()=>{if(!t.value.finished.length)return{firstRow:null,restRows:[]};const a=[...t.value.finished];return a.sort(it),ot(a)})}function it(t,e){return t.status!==e.status?t.status-e.status:t.timeSeconds!==e.timeSeconds?t.timeSeconds-e.timeSeconds:0}function ot(t){const e=t[0];if(e.status!==g.Ok)return{firstRow:null,restRows:t};const a={...e,rank:1,time:v(e.timeSeconds),loss:""};let d=a.time,m=a.rank;const f=t.slice(1).map((r,h)=>{if(r.status===g.Ok){const o=v(r.timeSeconds);return d===o||(m=h+2,d=o),{...r,rank:m,time:o,loss:rt(a,r)}}if(r.status===g.NotCompeting){const o=v(r.timeSeconds);return{...r,time:o}}return r});return{firstRow:a,restRows:f}}function rt(t,e){const a=e.timeSeconds-t.timeSeconds;return a===0?"":v(a)}function ct(t){return l(()=>{if(!t.value.unfinished.length)return[];const a=[...t.value.unfinished];return a.sort(ut),a})}function ut(t,e){return t.startTime&&e.startTime?t.startTime>e.startTime?1:-1:t.status!==e.status?t.status-e.status:t.surname<e.surname?-1:1}const lt={key:0,class:"w-full text-3xl font-bold bg-white"},dt={key:0,class:"w-full text-3xl font-bold bg-white"},mt={key:0,class:"bg-gray-300 h-100"},ft=y("span",null,"Loading data",-1),ht=[ft],bt=C({__name:"CategoryTable",props:{competition:null,category:null},setup(t){const e=t,a=D(),{scrollItemRef:d,stickyRef:m,contentRef:f,isActive:r}=I(e.category.name),{status:h,athletes:o,areAvailable:u}=nt({competition:e.competition,category:e.category,fetchEnabled:r}),R=l(()=>({finished:o.value.finished.length,unfinished:o.value.unfinished.length,full:o.value.finished.length+o.value.unfinished.length})),b=at(o),N=ct(o);return(gt,pt)=>(n(),i("div",{ref_key:"scrollItemRef",ref:d},[y("div",{class:"sticky top-0",ref_key:"stickyRef",ref:m},[U(B,{class:"p-3",category:e.category,"athletes-count":s(R)},null,8,["category","athletes-count"]),s(h)==="success"&&s(u)?(n(),i("div",lt,[s(b).firstRow?(n(),w(x,{key:0,data:s(b).firstRow,"is-even":!1,"is-compact":s(a).compactMode,class:"border-b-2 border-gray-600 border-dashed"},null,8,["data","is-compact"])):p("",!0)])):p("",!0)],512),y("div",{ref_key:"contentRef",ref:f},[s(h)==="success"&&s(u)?(n(),i("div",dt,[(n(!0),i(S,null,A(s(b).restRows,(_,k)=>(n(),w(x,{data:_,key:_.rank,"is-even":k%2===0,"is-compact":s(a).compactMode},null,8,["data","is-even","is-compact"]))),128)),s(a).showUnfinishedAthletes?(n(!0),i(S,{key:0},A(s(N),(_,k)=>(n(),w(st,{data:_,key:k,"is-even":k%2===0,"is-visible":s(r),"is-compact":s(a).compactMode,class:"border-t-2 border-gray-600 border-dashed"},null,8,["data","is-even","is-visible","is-compact"]))),128)):p("",!0)])):p("",!0)],512),s(h)==="success"&&s(u)?p("",!0):(n(),i("div",mt,ht))],512))}});export{bt as default};
