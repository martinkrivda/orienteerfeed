import{m as ae,r as p,c as x,n as X,d as N,o as _,a as D,b as o,t as G,u as l,g as K,w as Z,i as fe,p as pe,s as be,q as ye,x as ve,y as he,z as _e,e as xe,A as se,B as Ce,C as ke,l as J,h as ue,F as Y,f as Q,_ as le,j as P,D as q,E as we,G as re,H as ie,I as Se}from"./index-b9aa134f.js";import{u as Ie,b as Te,c as Re,d as De,a as Be,_ as Ve}from"./useDataProvider-11001eb3.js";const W=ae("settings",()=>{const g=p(!1);function t(s){typeof s>"u"?g.value=!g.value:g.value=s}const i=p(!1),n=p("page"),e=p(1);function c(s){e.value=s,A()}const d=p(.5),b=x(()=>d.value*1e3);function w(s){n.value=s}const B=p(!0),I=p([]),C=p([]),T=s=>{!s.length||JSON.stringify(s)===JSON.stringify(I.value)||(I.value=s,C.value=s.map(r))},R=x(()=>C.value.sort((s,f)=>s.order-f.order)),V=x(()=>R.value.filter(s=>s.selected)),M=p([]),$=s=>Array.from({length:s},()=>[]);X([V,e],a,{immediate:!0});function a(){M.value=V.value.reduce((s,f)=>(s[f.column-1].push(f),s),$(e.value))}function r(s,f){return{name:s,selected:!0,column:1,order:f}}function m(s,f){const v=f??!s.selected;s.selected=v,e.value===1?s.column=v?1:null:A()}function y(s,f){s.selected&&(f>e.value||(s.column=f,a()))}function k(s,f){const v=s.order,E=f?v-1:v+1,z=R.value[E];z.order=v,s.order=E}function A(){const s=Me(V.value,e.value);for(let f=0;f<s.length;f++)for(const v of s[f])v.column=f+1;a()}return{areSettingsDisplayed:g,setSettingsDisplayed:t,compactMode:i,scrollType:n,setScrollType:w,scrollColumnsCount:e,setScrollColumnsCount:c,readLineTimeSeconds:d,readLineTimeMS:b,showUnfinishedAthletes:B,availableCategories:I,categoriesDisplayRaw:C,categoriesDisplay:R,categoriesDisplayByColumn:M,setAvailableCategories:T,setCategoryDisplayColumn:y,setCategoryDisplayOrder:k,setCategorySelected:m}},{persist:!0});function Me(g,t){const i=[],n=[...g],e=Math.round(g.length/t);for(let c=t;c>1;c--)i.push(n.splice(0,e));return i.push(n),i}const Ae={class:"tabular-nums"},Fe=o("span",null,null,-1),Le={class:"absolute right-3 z-2 bg-header"},Pe=N({__name:"CompetitionHeader",props:{competition:null},setup(g){const t=g,i=W(),{nowFormatted:n}=Ie(),e=p(!1);return(c,d)=>{const b=pe("RouterLink");return _(),D("h1",{class:"flex justify-between gap-2.5 bg-header font-mrb font-bold text-4xl text-white p-3",onMouseenter:d[1]||(d[1]=w=>e.value=!0),onMouseleave:d[2]||(d[2]=w=>e.value=!1)},[o("span",Ae,G(l(n)),1),o("span",null,G(t.competition.name),1),Fe,o("div",Le,[K(b,{"data-testid":"home-button",to:"/"},{default:Z(()=>[fe("Home")]),_:1}),o("button",{onClick:d[0]||(d[0]=()=>l(i).setSettingsDisplayed()),class:"ml-3 i-mdi-cog"})])],32)}}}),ce=Symbol();function $e(g){const t=p(null),i=x(()=>t.value?t.value.getBoundingClientRect():{top:0,height:100,bottom:100}),n=[];let e=[];const c=be({}),d=x(()=>g.value==="none"||g.value==="continues"?250:1e3),b=Te(()=>{B()},100,{maxWait:d});Re(t,"scroll",b),ye(ce,a=>{n.push(a),b()});function B(){e=[];for(const a of n){const r=I(a.elementRef.value);r!==a.isActive.value&&(a.isActive.value=r),r&&e.push(a)}V()}function I(a){const r=a.getBoundingClientRect();return r.top<i.value.bottom+i.value.height&&r.bottom>i.value.top}function C(a,{top:r=i.value.top,bottom:m=i.value.bottom}={}){const y=a.getBoundingClientRect();return Math.round(y.bottom)<=Math.round(m)&&Math.round(y.top)>=Math.round(r)}function T(a){const r=a.getBoundingClientRect();return r.top<i.value.bottom&&r.bottom>i.value.top}const R=a=>{var m;const r=a.contentRef.value;return r?((m=r.children[0])==null?void 0:m.children)??[]:[]};function V(){c.value={};let a=!0;for(const r of e){const m=T(r.elementRef.value),y={item:r,isFirstItem:a,isVisible:m};a=!1;const k=R(r);if(m&&k.length>0){const A=[],s=r.stickyRef.value,f=s==null?void 0:s.getBoundingClientRect().bottom;for(let v=0;v<k.length;v++){const E=k[v];C(E,{top:f})&&A.push(v)}y.subItemsVisible=A,y.subItemsLength=k.length}c.value[r.id]=y}}function M(){var a;for(const r of e){const m=c.value[r.id];if(!m)continue;const y=((a=m.subItemsVisible)==null?void 0:a.length)||0;if(!m.isFirstItem)return{item:r,isFirstItem:!1};if(y>=2){const k=R(r);return{item:r,currentSubItem:k[m.subItemsVisible[0]],nextSubItem:k[m.subItemsVisible[1]],isFirstItem:!0}}}return null}function $(){var a;for(const r of e){const m=c.value[r.id];if(!m)continue;if(!m.isVisible)return{item:r,isFirstItem:m.isFirstItem};const y=(a=m.subItemsVisible)==null?void 0:a.slice(-1)[0],k=y!==void 0;if(!k&&!m.isFirstItem)return{item:r,isFirstItem:m.isFirstItem};if(k&&y<m.subItemsLength-1)return{item:r,nextSubItem:R(r)[y+1],isFirstItem:m.isFirstItem}}return null}return{columnWrapper:t,columnWrapperRect:i,columnItems:n,getNextItemOnPage:M,getNextItemBelowPage:$,checkItemsVisibility:V}}function Tt(g){const t=ve(ce);if(!t)throw new Error("registerScrollColumnItem not provided");const i=p(null),n=p(null),e=p(null),c=p(!1);return he(()=>{i.value&&t({id:g,elementRef:p(i.value),stickyRef:n,contentRef:e,isActive:c})}),{scrollItemRef:i,stickyRef:n,contentRef:e,isActive:c}}const de=ae("tableSizing",()=>{const g=p(50),t=p("single");return{lineHeight:x(()=>g.value*(t.value==="relay"?4:1)),mode:t}}),Ee=N({__name:"ScrollColumn",setup(g){const t=W(),i=de(),n=p(null),{columnWrapper:e,columnWrapperRect:c,getNextItemOnPage:d,getNextItemBelowPage:b,checkItemsVisibility:w}=$e(_e(t,"scrollType")),B=x(()=>c.value?Math.floor(c.value.height/i.lineHeight):0),I=x(()=>B.value*t.readLineTimeMS||1e3);let C=null,T={};const R={page:f,row:v,continues:E};X(()=>t.scrollType,u=>{C&&(C(),C=null),u!=="none"&&(C=R[u]())},{immediate:!0});function V(){return n.value?a(n.value):!0}function M(){return n.value?c.value.top>=0:!0}function $(){var u;(u=e.value)==null||u.scrollTo({top:0,behavior:"smooth"})}function a(u){const S=l(u).getBoundingClientRect(),F=16,L=S.bottom-c.value.bottom;return Math.floor(L)<=F}function r(u){var S,F,L;const h=u();if(!h){w();return}if(h.nextSubItem){const j=h.nextSubItem.getBoundingClientRect(),H=((S=h.item.stickyRef.value)==null?void 0:S.offsetHeight)||0,U=j.top-c.value.top-H;(F=e.value)==null||F.scrollBy({top:U,behavior:"smooth"})}else{const H=h.item.elementRef.value.getBoundingClientRect().top-c.value.top;(L=e.value)==null||L.scrollBy({top:H,behavior:"smooth"})}}const k={page:()=>r(b),row:()=>r(d)};function A(u){M()&&w(),V()?$():u()}function s(u,h){const S=T[u]??De(()=>A(k[u]),h);return T[u]||(T[u]=S),S.isActive.value||S.resume(),S.pause}function f(){return s("page",I)}function v(){return s("row",()=>t.readLineTimeMS)}function E(){const u=p(!1),h=()=>u.value=!0;return z(u),h}function z(u){window.setTimeout(()=>{u.value||me(u)},I.value/2)}function me(u){if(e.value===null||n.value===null)return;const h=e.value.getBoundingClientRect(),S=n.value.getBoundingClientRect(),F=S.bottom-(h.height+h.top),L=Math.floor(F/i.lineHeight)*t.readLineTimeMS,j=h.top-S.top,H=F;let U=null,O;const ee=function(te){var ne;if(u.value){O&&window.cancelAnimationFrame(O);return}U||(U=te);const oe=te-U,ge=Math.min(oe/L,1);(ne=e.value)==null||ne.scrollTo(0,j+H*ge),oe<L?O=window.requestAnimationFrame(ee):O&&(window.cancelAnimationFrame(O),window.setTimeout(()=>{u.value||($(),z(u))},I.value))};O=window.requestAnimationFrame(ee)}return(u,h)=>(_(),D("div",{class:"flex-1 overflow-y-scroll columnWrapper",ref_key:"columnWrapper",ref:e},[o("div",{ref_key:"columnContent",ref:n},[xe(u.$slots,"default")],512)],512))}});function Oe(g){const{getCompetitionLoader:t}=Be(),{competition:i,status:n}=t(g),e=de(),c=x(()=>i.value?[...i.value.categories].sort((w,B)=>w.name.localeCompare(B.name)):[]),d=x(()=>{if(i.value)return{...i.value,categories:c.value}});return X(()=>{var b;return(b=i.value)==null?void 0:b.isRelay},(b,w)=>{!b||b===w||(e.mode=b?"relay":"single")},{immediate:!0}),{competition:d,status:n}}const He={class:"font-mrb grow flex overflow-hidden pt-3"},Ue={key:1},Ne={key:2},We=N({__name:"CompetitionTable",props:{competitionId:null},setup(g){const t=g,i=se(()=>le(()=>import("./CategoryTable-e1949a2c.js"),["assets/CategoryTable-e1949a2c.js","assets/dateTime-aec4e621.js","assets/useDataProvider-11001eb3.js","assets/index-b9aa134f.js","assets/index-d89ae209.css","assets/CategoryTable-08f9cf01.css"])),n=se(()=>le(()=>import("./CategoryRelayTable-2fb417a3.js"),["assets/CategoryRelayTable-2fb417a3.js","assets/dateTime-aec4e621.js","assets/useDataProvider-11001eb3.js","assets/index-b9aa134f.js","assets/index-d89ae209.css","assets/CategoryRelayTable-47d3e90d.css"])),e=W(),{competitionId:c}=Ce(t),{competition:d,status:b}=Oe(c),w=x(()=>d.value?d.value.isRelay?n:i:null),B=x(()=>d.value?d.value.categories.reduce((C,T)=>(C[T.name]=T,C),{}):{}),I=x(()=>Object.keys(B.value));return ke(()=>e.setAvailableCategories(I.value)),(C,T)=>(_(),D(Y,null,[l(d)?(_(),J(Pe,{key:0,competition:l(d)},null,8,["competition"])):ue("",!0),o("div",He,[l(b)==="success"&&l(d)?(_(!0),D(Y,{key:0},Q(l(e).categoriesDisplayByColumn,(R,V)=>(_(),J(Ee,{key:"result-col-"+V,class:"px-1.5"},{default:Z(()=>[(_(!0),D(Y,null,Q(R,M=>(_(),J(l(w),{key:M.name,competition:l(d),category:l(B)[M.name],class:"mb-4"},null,8,["competition","category"]))),128))]),_:2},1024))),128)):l(b)==="loading"?(_(),D("div",Ue,"Loading data")):(_(),D("div",Ne,"Error occured while loading data, try again later"))])],64))}}),ze={class:"overflow-auto shadow-lg border-t-4 bg-white mb-4 rounded-l-lg rounded-t border-header w-full md:w-1/4"},je={class:"px-6 py-4 mt-4 mb-8"},qe=o("h3",null,"Result table settings",-1),Je={class:"mb-6"},Ye=o("h4",null,"Column number",-1),Ge={class:"flex flex-col items-start mb-2"},Ke=o("label",{for:"scroll-columns-count",class:"hidden block mb-1 mr-2 text-sm font-medium text-gray-900 dark:text-white"},"Column number",-1),Qe=["value"],Xe=o("h4",null,"(Auto) Scrolling",-1),Ze={class:"flex items-center mb-2"},et=o("label",{for:"scroll-page",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Scroll by page",-1),tt={class:"flex items-center mb-2"},ot=o("label",{for:"scroll-row",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Scroll by row",-1),nt={class:"flex items-center mb-2"},st=o("label",{for:"scroll-continues",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Continues scroll",-1),lt={class:"flex items-center mb-2"},rt=o("label",{for:"scroll-none",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Manual scroll",-1),it=o("h4",null,"Scroll speed (time per result line)",-1),at={class:"flex items-center mb-2"},ut={for:"scroll-speed",class:"block mb-1 mr-2 text-sm font-medium text-gray-900 dark:text-white"},ct=o("h4",null,"Table content",-1),dt={class:"flex items-center mb-2"},mt=o("label",{for:"unfinished-checkbox",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Show unfinished (startlist, running)",-1),gt={class:"flex items-center mb-2"},ft=o("label",{for:"compact-checkbox",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Compact mode (no club, card)",-1),pt=o("h5",null,"Displayed classes",-1),bt={class:"flex flex-col flex-wrap gap-y-2"},yt=["for"],vt=["id","checked","onChange"],ht=["value","onInput","max"],_t=["disabled","onClick"],xt=["disabled","onClick"],Ct=N({__name:"CompetitionSettings",setup(g){const t=W();return(i,n)=>(_(),D("div",ze,[o("div",je,[qe,o("form",null,[o("div",Je,[Ye,o("div",Ge,[Ke,o("input",{value:l(t).scrollColumnsCount,onInput:n[0]||(n[0]=e=>l(t).setScrollColumnsCount(parseInt(e.target.value))),id:"scroll-columns-count",type:"number",min:"1",max:"10",step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,40,Qe)]),Xe,o("div",Ze,[P(o("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>l(t).scrollType=e),id:"scroll-page",type:"radio",value:"page",name:"scroll by page",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,l(t).scrollType]]),et]),o("div",tt,[P(o("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>l(t).scrollType=e),id:"scroll-row",type:"radio",value:"row",name:"scroll by row",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,l(t).scrollType]]),ot]),o("div",nt,[P(o("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>l(t).scrollType=e),id:"scroll-continues",type:"radio",value:"continues",name:"scroll continuesly",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,l(t).scrollType]]),st]),o("div",lt,[P(o("input",{"onUpdate:modelValue":n[4]||(n[4]=e=>l(t).scrollType=e),id:"scroll-none",type:"radio",value:"none",name:"scroll manually",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,l(t).scrollType]]),rt]),it,o("div",at,[o("label",ut,G(l(t).readLineTimeSeconds)+"s",1),P(o("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>l(t).readLineTimeSeconds=e),id:"scroll-speed",type:"range",min:"0.1",max:"4",step:"0.1",class:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"},null,512),[[we,l(t).readLineTimeSeconds]])]),ct,o("div",dt,[P(o("input",{id:"unfinished-checkbox",type:"checkbox","onUpdate:modelValue":n[6]||(n[6]=e=>l(t).showUnfinishedAthletes=e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[re,l(t).showUnfinishedAthletes]]),mt]),o("div",gt,[P(o("input",{id:"compact-checkbox",type:"checkbox","onUpdate:modelValue":n[7]||(n[7]=e=>l(t).compactMode=e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[re,l(t).compactMode]]),ft]),pt,o("div",bt,[(_(!0),D(Y,null,Q(l(t).categoriesDisplay,e=>(_(),D("div",{key:e.name,class:"grid grid-cols-5 gap-2"},[o("label",{for:`show-category-${e.name}`,class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},G(e.name),9,yt),o("input",{id:`show-category-${e.name}`,type:"checkbox",checked:e.selected,onChange:()=>l(t).setCategorySelected(e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,40,vt),o("input",{value:e.column,onInput:c=>l(t).setCategoryDisplayColumn(e,parseInt(c.target.value)),type:"number",min:"1",max:l(t).scrollColumnsCount,step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-1"},null,40,ht),o("button",{disabled:e.order===0,onClick:ie(()=>l(t).setCategoryDisplayOrder(e,!0),["prevent"])}," Up ",8,_t),o("button",{disabled:e.order===l(t).categoriesDisplay.length-1,onClick:ie(()=>l(t).setCategoryDisplayOrder(e,!1),["prevent"])}," Down ",8,xt)]))),128))])])])])]))}}),kt={class:"w-screen h-screen overflow-hidden flex flex-col"},wt=N({__name:"CompetitionView",setup(g){const t=Se(),i=x(()=>t.params.competitionId??"1"),n=x(()=>t.params.providerId),e=W();return(c,d)=>(_(),D("div",kt,[K(Ve,{provider:l(n)},{default:Z(()=>[K(We,{"competition-id":l(i)},null,8,["competition-id"])]),_:1},8,["provider"]),l(e).areSettingsDisplayed?(_(),J(Ct,{key:0,class:"fixed inset-y-24 right-0 z-3"})):ue("",!0)]))}}),Rt=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));export{Rt as C,Tt as a,W as u};
